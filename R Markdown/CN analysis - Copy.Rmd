---
title: "CN analysis"
author: "Chiara"
date: "Monday, August 03, 2015"
output: html_document
---

Scope: volumes of CN's/DN's requested online in the last 12 months

Get data from the database:

select * from fin.ProposedCnDnInvoice
where created > '2014-08-01'

In the CSV file downloaded from MySQL
Divide the column "description" between CN code and description text with Data to columns
Save the new file as allCNproposed1.csv

Read the file into R

```{r}
cn = read.csv("C:/Users/cdiloreto/Google Drive/Programming/Data sets and exercises/WORK stuff/CNanalysis.csv")
View(cn)
```

Load ggplot2

```{r}
library(ggplot2)
qplot(data = cn, x = status)
```

Change order of the levels and plot again

```{r}
cn$status = factor(cn$status, levels = c("ready", "rejected", "approved", "pending"))
qplot(data = cn, x = status)
qplot(data = cn, x = status, color = I("black"), fill = I("orange"))
```

Check what is the ratio between approved CN's (status == "ready") and rejected CN's (status == "rejected")

```{r}
nrow(subset(cn, status == "ready"))
nrow(subset(cn, status == "rejected"))
hitrate = nrow(subset(cn, status == "rejected")) / nrow(subset(cn, status == "ready"))
percentage = round((nrow(subset(cn, status == "rejected"))/nrow(subset(cn, status == "ready"))) * 100, 1)
```

Isolate rejected CN's (the ones we want to investigate)

```{r}
rejected = subset(cn, status == "rejected")
```

Work on processed CN's (exclude "approved" and "pending").
Plot how many rejections vs. approved by FA

```{r}
cnp = subset(cn, status %in% c("ready", "rejected"))
qplot(x = status, data = cnp, color = I("black"), fill = I("lightblue"))
```

###Analysis on the codes
Codes are not precise enough, so I decided to exclude everything apart from this (factor only the values I am interested in):

```{r}
cn$code = factor(cn$code, c("C13 ","CC1 ","CC2 ","CC3 ","CC4 ","CC5 ","CC6 ","CC9 ","CD1 ","CD2 ","CD3 ","CS1 ","CS2 ","CS3 ","HT1 ","HT2 ","FA3 "))
```

